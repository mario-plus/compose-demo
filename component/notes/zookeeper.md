1. zookeeper是什么
    分布式协调服务，提供数据发布订阅，命名服务，分布式锁，负载均衡等功能(内存加载数据，日志持久化数据)
    采用多层级的节点命名空间（树状结构）
    为保证高吞吐和低延迟，不能用于存放大量的数据，每个节点的存放数据上限为1M
    文件系统，通知机制（观察者模式）
2. Zab协议是什么
    Zookeeper 的核心是原子广播机制（Zab协议），保证了各个 server 之间的同步
    Zab 协议有两种模式，它们分别是恢复模式和广播模式
        恢复模式：leader崩溃重新选举
        广播模式：leader正常，正常广播同步消息
3. 什么是分布式一致性？zookeeper如何保证事务的顺序一致性
    当一个节点数据发生更改，其他节点对应的数据也要发生改变，无论客户端从哪台服务器读取的数据都是一样的
    如果一个节点数据发生更改，到另一节点数据发生更改的时间比较长，则为弱一致性，当这个时间比较短，则为最终一致性
    如果所有节点数据发生更改才能读取到更新数据，则为强一致性
    zookeeper通过两阶段提交，尽可能追求强一致性（实际为最终一致性）
    Zookeeper 采用了递增的事务 id 来识别，所有的写操作都被加上了Zxid
    Zxid(高32位表示Leader是否发生改变，低32位用来递增计数)
    当写请求过来（follower,observer会将写请求转发给Leader）
    leader会先生成日志，再广播同步消息给follower和observer
    follower收到同步请求，同时也会生成日志，返回Ack，observer收到同步请求，不会返回Ack
    leader收到follower返回的Ack（过半机制），才会更新内存数据，同时广播commit消息
    follower和observer收到commit消息之后，也会更新内存数据
4. 什么是两阶段提交
    参考3
5. zookeeper快速领导者选举是怎么做的
    开始投票 -> 节点状态变成 LOOKING -> 每个节点选自己
    -> 收到票进行 PK -> (zxid,myid)的获胜 -> 更新选票 
    -> 再次投票 -> 统计选票，选票过半数选举结果 
    -> 节点状态更新为自己的角色状态。
6. zookeeper的观察者节点的作用
    观察者不参与投票选举及写操作ack确认，提供性能
    观察者可以提搞读性能
7. zookeeper为什么建议用奇数节点搭建集群
    过半机制：选举和写操作确认
    5个服务器可以挂两个，6个服务器也只能挂两个
8. 节点类型
    持久节点：一直存在
    临时节点：会话关闭，自动结束
9. 服务器角色（LOOKING寻找leader）
   Leader：事务请求的唯一调度和处理者，保证集群事务处理的顺序性
   Follower：转发事务请求，投票选举，事务请求投票（ACK）
   Observer： 转发事务请求（不参与任何形式的投票）

10. zookeeper watch机制流程
    a. 客户端注册 Watcher（封装成Package对象发送给服务端）           
    b. 服务端收到，存储watcher，并响应客户端
    c. 客户端收到服务端响应，通过ZKWatcherManager管理Manager         
    d. 服务端监测数据变化，触发Watcher，通知客户端
    e. 客户端SendThread线程接收事件通知，由EventThread线程回调Watcher 
    备注：无论是服务端还是客户端，一旦一个 Watcher 被触发， Zookeeper 都会将其从相应的存储中移除
    
11. ZooKeeper 集群中个服务器之间是怎样通信的？
    Leader 服务器会和每一个 Follower/Observer 服务器都建立 TCP 连接
    
12. zookeeper如何实现分布式锁
    独占式锁：所有客户端创建一个Znode，用完就删除（创建失败就是抢锁失败）
    控制时序锁：所有客户端在同一个节点下创建临时顺序目录节点，编号最小的获取锁，用完就删除
13. zookeeper是否支持动态扩容
    3.5版本后是支持动态扩容
    全部重启
    逐个重启：过半机制后，一个设备重启不影响整个集群对外提供服务
    

    
